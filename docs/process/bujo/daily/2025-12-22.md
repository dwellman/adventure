# Daily Log â€” 2025-12-22

## What I touched
- Expanded GDL CLI smoke coverage to include GameStructExporter, WorldFingerprintDump, and WorldIdDump, with shared output capture helpers.
- Removed the GDL demo entry from the GameCli menu.
- Moved storybook bundles under `src/main/resources/storybook`, switched StorybookSharedLoader to classpath resources, and updated docs/tests for the new path.
- Moved the top-level `prompts/` markdown files into `src/main/resources/agents` and updated the gardener expander to load its prompt from classpath resources.
- Standardized markdown filenames to lowercase, simple hyphenated names and updated references, including shorter design doc names.
- Shortened long prompt filenames (gardener/narrator system prompts, dm1 v1) and updated the gardener loader path.
- Implemented cell maps with DSL access, receipts, and YAML load/save support across structured and monolithic paths.
- Added cell operation + attribute access tests.
- Wired cell usage into SEARCH/USE/crafting (cell consumption + transfer) and added sample cells to island actors/items.
- Added Combat v1 runtime (encounter, dice checks, receipts) and CLI commands for attack/flee.
- Extended item/actor recipes + builders for weapon/armor stats and equipped items, updating YAML load/write paths.
- Added combat + command parsing tests for the new verbs and receipts.
- Added ItemRecipeBuilder and routed all recipe creation through builders (Item/Actor) across loaders, samples, and tests.
- Documented design patterns with associated testing patterns.
- Linked pattern testing strategies from design docs.
- Added TODO testing gaps list and aligned translator/narrator prompts with CLI combat/usage behavior.
- Adjusted key-expression test helper to accept strict unknown-reference exceptions.
- Aligned narrator prompt placeholders with the updated engine inputs and verified prompt tests.
- Added combat receipt/invariant tests plus CLI combat error-path assertions, and tightened prompt sanitization/coverage tests.
- Marked completed testing gaps in the pattern tests doc.
- Replaced direct Item/Actor/Plot/Gate construction with builders and aligned tests to builder defaults/owner requirements.
- Added builder overloads for Thing references (owner/plot/host), relaxed PlotBuilder id requirement, and switched tests to pass owners as Things.
- Enforced non-null Thing ownership, defaulted plot owners to Miliarium, and attached gate owners to plot references.
- Swept builder usage to drop redundant defaults/UUIDs and use Thing references where available.
- Swept remaining builder calls to use Thing references and defaults, removed extra UUID imports, and cleaned owner assignments in tests.
- Ran the full test suite.
- Wired TranslationOrchestrator into GameCli, preserving question/color handling and failure messaging.
- Added orchestration, grounding, mutation, and learning tests plus golden prompt fixtures and replay traces.
- Added prompt evaluation harness tests for A/B scoring and drift thresholds.
- Added full-name direction aliases and updated test helpers to use full-name direction constants.
- Adjusted evaluation harness variable names to avoid abbreviations.
- Restored classic-mode fallback behind a scanner-only adapter and limited it to compiler-unknown inputs.
- Expanded scanner directions/prepositions and aligned compiler handling for RUN AWAY and new prepositions.
- Added classic fallback tests plus scanner/compiler coverage for directions and prepositions.
- Clarified classic fallback policy in AGENTS.md.
- Updated verb alias test to match RUN -> MOVE canonicalization after scanner/compiler alignment.
- Added regression coverage for RUN + direction mapping to GO in the compiler.
- Added scanner coverage for RUN + direction mapping to MOVE then direction tokens.
- Documented the AI-enabled end-to-end runbook and added a temporary root TODO for tomorrow.
- Added a verification checklist to the AI-enabled runbook.
- Mapped runbook verification checklist to grounding/orchestration/verification/trust UX/learning pattern tests.
- Added a pattern coverage matrix to the pattern tests doc.

## Notes / Risks
- GDL export smoke test writes to `target/gdl-export-*`.
- Storybook shared templates now load from classpath resources (no filesystem fallback).
- Removed the root `prompts/` directory and deleted stray `.DS_Store` files.
- Case-only renames may need a manual `git mv` on case-insensitive filesystems.
- Cell attribute reads return zero/empty values for missing cells; mutations emit `MISSING_CELL` receipts.
- USE now transfers matching cell contents between things when possible; SEARCH consumes stamina.
- Combat is in-memory only (no save/load for encounters).
- Kernel receipt stream now includes combat receipts alongside cell receipts for ordered testing.

## Tests / Evidence
- `mvn -q -Dtest=GdlCliSmokeTest test`
- `mvn -q -Dtest=StorybookValidateCliSmokeTest,ZoneGraphBuilderTest test`
- `mvn -q -Dtest=StorybookValidateCliSmokeTest test`
- `mvn -q -Dtest=CellOpsTest,KeyExpressionEvaluatorTest test`
- `mvn -q -Dtest=CellOpsTest,KeyExpressionEvaluatorTest,CraftingTableFlowTest,GameCliCraftTest test`
- `mvn -q -Dtest=CommandCompilerTest,CommandScannerTest,VerbAliasesTest,CombatEngineTest,GameMenuStructuredLoadTest test`
- `mvn -q -Dtest=CraftingTableFlowTest,GameCliCraftTest,CombatEngineTest,CommandCompilerTest test`
- `mvn -q -Dtest=KeyExpressionEvaluatorTest test`
- `mvn -q -Dtest=TranslatorPromptCoverageTest,TranslatorRoutingGoldenTest,NarratorPromptSelectionTest,NarratorFallbackTest test`
- `mvn -q -Dtest=CombatEngineTest,GameCliCombatErrorTest,TranslatorPromptCoverageTest,NarratorPromptSelectionTest test`
- `mvn -q -Dtest=CraftingTableFlowTest,KeyExpressionEvaluatorTest,CellOpsTest,DmNarratorTest,MovementGateTest,WorldOwnershipValidationTest,OpenAiHttpFixtureDescriptionExpanderTest,GameCliCraftTest,SearchTest,LookTest,DescribeTest,MoveTest,InventoryPackingTest,OpenKernelTest,CloseTest,GameCliExitFormattingTest test`
- `mvn -q -Dtest=CraftingTableFlowTest,KeyExpressionEvaluatorTest,CellOpsTest,DmNarratorTest,MovementGateTest,WorldOwnershipValidationTest,OpenAiHttpFixtureDescriptionExpanderTest,GameCliCraftTest,SearchTest,LookTest,DescribeTest,MoveTest,InventoryPackingTest,OpenKernelTest,CloseTest,GameCliExitFormattingTest,BuilderDefaultsTest test`
- `mvn -q -Dtest=BuilderDefaultsTest,CraftingTableFlowTest,KeyExpressionEvaluatorTest,CellOpsTest,DmNarratorTest,MovementGateTest,WorldOwnershipValidationTest,OpenAiHttpFixtureDescriptionExpanderTest,GameCliCraftTest,SearchTest,LookTest,DescribeTest,MoveTest,InventoryPackingTest,OpenKernelTest,CloseTest,GameCliExitFormattingTest test`
- `mvn -q -Dtest=BuilderDefaultsTest,WorldBuilderTest,WorldAssemblerMapOnlyTest,WorldOwnershipValidationTest,GameCliExitFormattingTest,GameCliCraftTest,KeyExpressionEvaluatorTest,SearchTest,LookTest,DescribeTest,MoveTest,InventoryPackingTest,OpenKernelTest,CloseTest,CellOpsTest,OpenAiHttpFixtureDescriptionExpanderTest,CraftingTableFlowTest test`
- `mvn -q -Dtest=CombatEngineTest,GameCliCombatErrorTest,BuilderDefaultsTest,WorldBuilderTest,WorldAssemblerMapOnlyTest,WorldOwnershipValidationTest,GameCliExitFormattingTest,GameCliCraftTest,KeyExpressionEvaluatorTest,SearchTest,LookTest,DescribeTest,MoveTest,InventoryPackingTest,OpenKernelTest,CloseTest,CellOpsTest,OpenAiHttpFixtureDescriptionExpanderTest,CraftingTableFlowTest test`
- `mvn -q test`
- `mvn -q test` (repeat)
- `mvn -q -Dtest=TranslationOrchestratorTest,NarratorFallbackTest,TranslatorPromptGoldenTest,NarratorPromptGoldenTest,PromptEvaluationHarnessTest,CellMutationReceiptMutationTest,GameCliCombatErrorTest,GameCliExitFormattingTest,GameCliCraftTest test`
- `mvn -q -Dtest=TranslationOrchestratorTest,PromptEvaluationHarnessTest,NarratorPromptGoldenTest,TranslatorPromptGoldenTest test`
- `mvn -q -Dtest=CommandScannerTest,CommandCompilerTest,ClassicCommandFallbackTest test`
- `mvn -q -Dtest=VerbAliasesTest,CommandScannerTest,CommandCompilerTest,ClassicCommandFallbackTest test`
- `mvn -q -Dtest=CommandCompilerTest test`
- `mvn -q -Dtest=CommandScannerTest test`
- Tests: Not run (docs/runbook/pattern docs only).

## Next
- (None)
